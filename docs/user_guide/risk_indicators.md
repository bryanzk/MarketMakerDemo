# Risk Indicators User Guide / 风险指标用户指南

## 概述

本指南介绍 AlphaLoop 的**风险监控指标**，帮助您实时了解交易风险状况，及时采取行动防止重大亏损。

---

## 1. Liquidation Buffer / 强平缓冲

### 1.1 功能说明

Liquidation Buffer（强平缓冲）显示当前价格距离强制平仓价格的安全距离，是**防止爆仓的第一道防线**。

### 1.2 计算公式

```
Liquidation Buffer = (当前价格 - 强平价格) / 当前价格 × 100%

对于空头仓位:
Liquidation Buffer = (强平价格 - 当前价格) / 当前价格 × 100%
```

### 1.3 风险等级

| 缓冲值 | 状态 | 颜色 | 建议操作 |
|--------|------|------|----------|
| > 20% | 安全 | 🟢 绿色 | 正常运行 |
| 10% - 20% | 警告 | 🟡 黄色 | 关注市场波动 |
| 5% - 10% | 危险 | 🟠 橙色 | 考虑减仓 |
| < 5% | 紧急 | 🔴 红色 | 立即减仓或补充保证金 |

### 1.4 使用场景

**场景 A：日常监控**
> 每次打开仪表盘，首先检查 Liquidation Buffer。如果低于 10%，需要立即评估是否需要减仓。

**场景 B：极端行情**
> 市场剧烈波动时（如重大新闻发布），Liquidation Buffer 可能快速下降。系统会在低于阈值时发出预警。

**场景 C：杠杆调整**
> 增加杠杆会降低 Liquidation Buffer。在调整杠杆前，先检查当前缓冲是否充足。

### 1.5 预警机制

- **< 10%**：Dashboard 显示黄色警告
- **< 5%**：Dashboard 显示红色警告 + 闪烁提示
- **< 3%**：建议自动暂停策略（可配置）

---

## 2. Inventory Drift / 库存偏移

### 2.1 功能说明

Inventory Drift（库存偏移）衡量做市商持仓的**方向性风险**。理想的做市商应保持净持仓接近零。

### 2.2 计算公式

```
Inventory Drift = 净持仓 / 最大允许持仓 × 100%

净持仓 = 多头仓位 - 空头仓位（对于双向持仓）
       = 当前持仓数量（对于单向持仓）
```

### 2.3 风险等级

| 偏移值 | 状态 | 颜色 | 含义 |
|--------|------|------|------|
| -20% ~ +20% | 平衡 | 🟢 绿色 | 库存健康 |
| -50% ~ -20% 或 +20% ~ +50% | 偏移 | 🟡 黄色 | 存在方向性敞口 |
| -80% ~ -50% 或 +50% ~ +80% | 严重偏移 | 🟠 橙色 | 需要调整报价 |
| < -80% 或 > +80% | 极端偏移 | 🔴 红色 | 暂停做市或反向操作 |

### 2.4 使用场景

**场景 A：做市策略监控**
> 作为做市商，我需要保持库存平衡。当 Inventory Drift > 50% 时，表示我持有过多多头仓位，需要调整 bid/ask 报价以吸引更多卖单。

**场景 B：趋势市场**
> 在单边趋势市场中，库存容易积累偏移。此时需要考虑暂停做市或加大价差。

**场景 C：策略对比**
> 不同策略的库存偏移可以反映其对冲效率。偏移小的策略通常更稳定。

### 2.5 偏移方向说明

| 方向 | 含义 | 风险 |
|------|------|------|
| **正偏移 (+)** | 净多头仓位 | 价格下跌时亏损 |
| **负偏移 (-)** | 净空头仓位 | 价格上涨时亏损 |

---

## 3. Max Drawdown / 最大回撤

### 3.1 功能说明

Max Drawdown（最大回撤）衡量策略从峰值到谷底的**最大亏损幅度**，是评估策略风险的核心指标。

### 3.2 计算公式

```
Max Drawdown = (峰值净值 - 谷底净值) / 峰值净值 × 100%

策略级回撤 = 该策略单独的最大回撤
组合级回撤 = 所有策略合计的最大回撤
```

### 3.3 风险等级

| 回撤值 | 状态 | 颜色 | 建议操作 |
|--------|------|------|----------|
| < 5% | 优秀 | 🟢 绿色 | 策略运行良好 |
| 5% - 10% | 正常 | 🟡 黄色 | 正常波动范围 |
| 10% - 20% | 警告 | 🟠 橙色 | 检查策略参数 |
| > 20% | 危险 | 🔴 红色 | 考虑暂停策略 |

### 3.4 使用场景

**场景 A：策略评估**
> 新策略上线一周后，检查其 Max Drawdown。如果超过 10%，需要分析是市场原因还是策略问题。

**场景 B：资金分配决策**
> 回撤小的策略可以分配更多资金。例如：策略A回撤5%、策略B回撤15%，应减少策略B的资金分配。

**场景 C：止损设置**
> 可以设置自动止损规则：当策略回撤超过15%时，自动暂停该策略。

### 3.5 策略级 vs 组合级回撤

| 类型 | 说明 | 用途 |
|------|------|------|
| **策略级回撤** | 单个策略的回撤 | 识别问题策略 |
| **组合级回撤** | 所有策略合计 | 整体风险控制 |

> 💡 低相关性的策略组合可以降低组合级回撤

---

## 4. Risk Dashboard 布局

### 4.1 风险指标卡片

```
┌─────────────────────────────────────────────────────────────────┐
│ ⚠️ Risk Indicators                                              │
│ ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐ │
│ │ Liquidation      │ │ Inventory        │ │ Max Drawdown     │ │
│ │ Buffer           │ │ Drift            │ │                  │ │
│ │                  │ │                  │ │                  │ │
│ │   15.2%          │ │   +32.5%         │ │   -4.8%          │ │
│ │   ⚠️ Warning     │ │   🟡 Offset      │ │   🟢 Good        │ │
│ └──────────────────┘ └──────────────────┘ └──────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 策略级风险表

| Strategy | Liq Buffer | Inv Drift | Max DD | Risk Level |
|----------|------------|-----------|--------|------------|
| Fixed Spread | 18.5% 🟢 | +12% 🟢 | -3.2% 🟢 | Low |
| Funding Rate | 12.3% 🟡 | +45% 🟡 | -8.1% 🟡 | Medium |

---

## 5. API 参考

### 5.1 获取风险指标

```bash
GET /api/risk-indicators

# 响应示例
{
  "liquidation_buffer": 15.2,
  "liquidation_buffer_status": "warning",
  "inventory_drift": 32.5,
  "inventory_drift_status": "offset",
  "max_drawdown": -4.8,
  "max_drawdown_status": "good",
  "overall_risk_level": "medium",
  "strategies": [
    {
      "id": "fixed_spread",
      "liquidation_buffer": 18.5,
      "inventory_drift": 12.0,
      "max_drawdown": -3.2,
      "risk_level": "low"
    },
    {
      "id": "funding_rate",
      "liquidation_buffer": 12.3,
      "inventory_drift": 45.0,
      "max_drawdown": -8.1,
      "risk_level": "medium"
    }
  ]
}
```

---

## 6. 常见问题

### Q1: Liquidation Buffer 显示 N/A 是什么意思？
表示当前没有持仓，或无法从交易所获取强平价格。

### Q2: Inventory Drift 为负数代表什么？
表示净空头仓位。例如 -30% 表示空头方向偏移 30%。

### Q3: 这些指标多久更新一次？
默认每 3 秒更新一次，可在设置中调整刷新频率。

### Q4: 如何设置风险阈值预警？
目前使用默认阈值，未来版本将支持自定义阈值配置。

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2024-01 | 初始版本：三大风险指标 |


