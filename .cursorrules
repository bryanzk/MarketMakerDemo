# MarketMakerDemo Cursor Rules
# å¤š Agent åä½œå¼€å‘è§„èŒƒ v2.0

## é¡¹ç›®è¯­è¨€
- æ‰€æœ‰å“åº”ä½¿ç”¨ç®€ä½“ä¸­æ–‡
- ä»£ç æ³¨é‡Šä½¿ç”¨è‹±æ–‡
- **æ‰€æœ‰æ–‡æ¡£å¿…é¡»ä¸­è‹±æ–‡åŒè¯­** (Bilingual documentation required)
  - æ¯ä¸ªæ ‡é¢˜/æ®µè½å…ˆå†™è‹±æ–‡ï¼Œå†å†™ä¸­æ–‡
  - æ ¼å¼ç¤ºä¾‹: `## Feature Name / åŠŸèƒ½åç§°`
  - ç¡®ä¿ä¸¤ç§è¯­è¨€å†…å®¹ä¸€è‡´

---

## ğŸ¤– Agent ä½“ç³» (9 Agents)

### ç®¡ç†å±‚ / Management Layer
| Agent | è§’è‰² | èŒè´£ | ä¸Šä¸‹æ–‡æ–‡æ¡£ |
|-------|------|------|-----------|
| **Agent PM** | é¡¹ç›®ç®¡ç† | è¿›åº¦è·Ÿè¸ªã€åè°ƒæ²Ÿé€šã€é£é™©ç®¡ç†ã€é¡¹ç›®æ²»ç†ã€å®¡è®¡æ—¥å¿— | `docs/agents/AGENT_PM.md` |
| **Agent PO** | äº§å“è´Ÿè´£äºº | éœ€æ±‚è§„æ ¼ã€ç”¨æˆ·æ•…äº‹ã€éªŒæ”¶æ ‡å‡† | `docs/agents/AGENT_PO.md` |
| **Agent ARCH** | æ¶æ„å¸ˆ | æ¥å£å¥‘çº¦ã€æ¨¡å—è®¾è®¡ã€å…±äº«ä»£ç  | `docs/agents/AGENT_ARCH.md` |

### å¼€å‘å±‚ / Development Layer
| Agent | è§’è‰² | èŒè´£ | ä¸Šä¸‹æ–‡æ–‡æ¡£ |
|-------|------|------|-----------|
| **Agent TRADING** | äº¤æ˜“å¼•æ“å¼€å‘ | äº¤æ˜“æ‰€è¿æ¥ã€è®¢å•ç®¡ç†ã€ç­–ç•¥å®ç° | `docs/agents/AGENT_TRADING.md` |
| **Agent PORTFOLIO** | ç»„åˆç®¡ç†å¼€å‘ | ç»„åˆç®¡ç†ã€é£é™©æŒ‡æ ‡ã€å¥åº·åº¦ | `docs/agents/AGENT_PORTFOLIO.md` |
| **Agent WEB** | Web/API å¼€å‘ | FastAPI æœåŠ¡ã€API è·¯ç”±ã€å‰ç«¯æ¨¡æ¿ | `docs/agents/AGENT_WEB.md` |
| **Agent AI** | AI/LLM å¼€å‘ | LLM é›†æˆã€æ™ºèƒ½ä½“ã€è¯„ä¼°æ¡†æ¶ | `docs/agents/AGENT_AI.md` |

### è´¨é‡å±‚ / Quality Layer
| Agent | è§’è‰² | èŒè´£ | ä¸Šä¸‹æ–‡æ–‡æ¡£ |
|-------|------|------|-----------|
| **Agent QA** | è´¨é‡ä¿è¯ | é›†æˆæµ‹è¯•ã€å†’çƒŸæµ‹è¯•ã€ç”¨æˆ·æ–‡æ¡£ã€æµ‹è¯•å®¡æŸ¥ | `docs/agents/AGENT_QA.md` |
| **Agent REVIEW** | ä»£ç å®¡æŸ¥ | ä»£ç è´¨é‡ã€æœ€ä½³å®è·µã€å®‰å…¨å®¡æŸ¥ | `docs/agents/AGENT_REVIEW.md` |

---

## ğŸ“‹ å¼€å‘æµç¨‹ (17 Steps / 17 æ­¥)

**Note / è¯´æ˜**: æµç¨‹åˆ†ä¸º 7 ä¸ªé˜¶æ®µï¼ŒåŒ…å« 2 ä¸ªäººå·¥æ‰¹å‡†é—¨ç¦ï¼ˆSteps 4, 17ï¼‰
The workflow is divided into 7 phases with 2 human approval gates (Steps 4, 17)

```
Plan: Spec â†’ Story â†’ AC â†’ [APPROVAL] â†’ Design: Contract â†’ 
Dev: Test(Red) â†’ Code(Green) â†’ Quality: Lint â†’ Security â†’ 
Review â†’ Test: Unit â†’ Smoke â†’ Integration â†’ 
Docs: Docs â†’ Progress â†’ CI/CD â†’ [RELEASE]
```

| Step | Phase | çŠ¶æ€å­—æ®µ | è´Ÿè´£ Agent | äº§å‡ºç‰© | Notes / å¤‡æ³¨ |
|------|------|---------|-----------|--------|-------------|
| 1 | Plan | `spec_defined` | Agent PO | `docs/specs/{module}/{feature}.md` | |
| 2 | Plan | `story_defined` | Agent PO | `docs/stories/{module}/US-{ID}.md` | |
| 3 | Plan | `ac_defined` | Agent PO | AC å†™å…¥ Story æ–‡ä»¶ | |
| 4 | Plan | `plan_approved` | Human | ğŸ›‘ STOP GATE - ç­‰å¾…æ‰¹å‡† | **NEW** |
| 5 | Design | `contract_defined` | Agent ARCH | `contracts/{module}.json` | |
| 6 | Dev | `unit_test_written` | Dev Agent (æŒ‰ owner) | `tests/unit/{module}/test_{feature}.py` | TDD: Red |
| 7 | Dev | `code_implemented` | Dev Agent (æŒ‰ owner) | `src/{module}/...` | TDD: Green |
| 8 | Quality | `lint_passed` | Dev Agent + Tool | Linter æŠ¥å‘Š | **NEW** |
| 9 | Quality | `security_check_passed` | Dev Agent + Tool | å®‰å…¨æ‰«ææŠ¥å‘Š | **NEW** |
| 10 | Review | `code_reviewed` | Agent REVIEW | `logs/reviews/{feature_id}.json` | |
| 11 | Test | `unit_test_passed` | Dev Agent (æŒ‰ owner) | pytest æŠ¥å‘Š | |
| 12 | Test | `smoke_test_passed` | Agent QA | å†’çƒŸæµ‹è¯•æŠ¥å‘Š | |
| 13 | Test | `integration_passed` | Agent QA | é›†æˆæµ‹è¯•æŠ¥å‘Š | |
| 14 | Docs | `docs_updated` | Agent QA | `docs/user_guide/{module}/...` | |
| 15 | Ops | `progress_logged` | Agent PM | `status/roadmap.json` | |
| 16 | Ops | `ci_cd_passed` | Automated | GitHub Actions ç»“æœ | |
| 17 | Ops | `release_approved` | Human | ğŸ›‘ STOP GATE - ç­‰å¾…å‘å¸ƒæ‰¹å‡† | **NEW** |

### é˜¶æ®µåˆ’åˆ† / Phase Organization

å¼€å‘æµç¨‹åˆ†ä¸º 7 ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µæœ‰æ˜ç¡®çš„èŒè´£ï¼š
The workflow is divided into 7 phases, each with clear responsibilities:

1. **Phase 1: Plan (è§„åˆ’)** - Steps 1-4
   - éœ€æ±‚å®šä¹‰å’Œæ‰¹å‡† / Requirements definition and approval
   - åŒ…å«äººå·¥æ‰¹å‡†é—¨ç¦ / Includes human approval gate

2. **Phase 2: Design (è®¾è®¡)** - Step 5
   - æ¥å£å¥‘çº¦å®šä¹‰ / Interface contract definition

3. **Phase 3: Dev (å¼€å‘ - TDD)** - Steps 6-7
   - æµ‹è¯•é©±åŠ¨å¼€å‘ / Test-driven development
   - Red Phase: å…ˆå†™æµ‹è¯• / Write tests first
   - Green Phase: å®ç°ä»£ç ä½¿æµ‹è¯•é€šè¿‡ / Implement code to pass tests

4. **Phase 4: Quality (é™æ€è´¨é‡)** - Steps 8-9
   - ä»£ç æ ¼å¼æ£€æŸ¥ / Code formatting check (Lint)
   - å®‰å…¨æ£€æŸ¥ / Security check
   - å·¥å…·è¾…åŠ©æ­¥éª¤ / Tool-assisted steps

5. **Phase 5: Review (å®¡æŸ¥)** - Step 10
   - ä»£ç å®¡æŸ¥ / Code review

6. **Phase 6: Test (åŠ¨æ€æµ‹è¯•)** - Steps 11-13
   - å•å…ƒæµ‹è¯• / Unit tests
   - å†’çƒŸæµ‹è¯• / Smoke tests
   - é›†æˆæµ‹è¯• / Integration tests

7. **Phase 7: Docs & Ops (æ–‡æ¡£ä¸äº¤ä»˜)** - Steps 14-17
   - æ–‡æ¡£æ›´æ–° / Documentation
   - è¿›åº¦è®°å½• / Progress logging
   - CI/CD æ£€æŸ¥ / CI/CD checks
   - å‘å¸ƒæ‰¹å‡† / Release approval (äººå·¥é—¨ç¦ / Human gate)

---

## âš ï¸ Agent èŒè´£ç¡®è®¤è§„åˆ™ï¼ˆé‡è¦ï¼‰

å½“ä½ è¢«åˆå§‹åŒ–ä¸ºæŸä¸ªç‰¹å®š Agent åï¼ˆé€šè¿‡é˜…è¯» `docs/agents/AGENT_XXX.md`ï¼‰ï¼Œ
åœ¨å¤„ç†ä»»ä½•ä»»åŠ¡è¯·æ±‚æ—¶ï¼Œå¿…é¡»ï¼š

### 1. é¦–å…ˆç¡®è®¤ä»»åŠ¡å½’å±
æ£€æŸ¥ç”¨æˆ·è¯·æ±‚æ¶‰åŠçš„æ–‡ä»¶/æ¨¡å—æ˜¯å¦åœ¨ä½ çš„èŒè´£èŒƒå›´å†…ã€‚
**åœ¨æå‡ºä¿®æ”¹å»ºè®®å‰ï¼Œå¿…é¡»æ€»æ˜¯å…ˆé˜…è¯»å¹¶ç†è§£ç›¸å…³æ–‡ä»¶ã€‚ç»å¯¹ä¸è¦å¯¹è‡ªå·±æ²¡æ£€æŸ¥è¿‡çš„ä»£ç è¿›è¡ŒçŒœæµ‹ã€‚**

### 2. è‡ªåŠ¨è§’è‰²è¯†åˆ«
æ ¹æ® `status/roadmap.json` ä¸­ Feature çš„ `current_step` å’Œ `owner` è‡ªåŠ¨è¯†åˆ«ï¼š

```
current_step: spec_defined          â†’ Agent PO
current_step: story_defined         â†’ Agent PO
current_step: ac_defined            â†’ Agent PO
current_step: plan_approved         â†’ Human (ğŸ›‘ STOP GATE)  # NEW
current_step: contract_defined       â†’ Agent ARCH
current_step: unit_test_written     â†’ Dev Agent (æŒ‰ owner)
current_step: code_implemented      â†’ Dev Agent (æŒ‰ owner)
current_step: lint_passed           â†’ Dev Agent + Tool  # NEW
current_step: security_check_passed â†’ Dev Agent + Tool  # NEW
current_step: code_reviewed         â†’ Agent REVIEW
current_step: unit_test_passed      â†’ Dev Agent (æŒ‰ owner)
current_step: smoke_test_passed     â†’ Agent QA
current_step: integration_passed    â†’ Agent QA
current_step: docs_updated          â†’ Agent QA
current_step: progress_logged       â†’ Agent PM
current_step: ci_cd_passed          â†’ Automated
current_step: release_approved      â†’ Human (ğŸ›‘ STOP GATE)  # NEW

Dev Agent æŒ‰ owner å­—æ®µæ˜ å°„:
  owner: "trading"   â†’ Agent TRADING
  owner: "portfolio" â†’ Agent PORTFOLIO
  owner: "web"       â†’ Agent WEB
  owner: "ai"        â†’ Agent AI
```

### 3. å¦‚æœä»»åŠ¡å±äºä½ çš„èŒè´£
å›å¤æ ¼å¼ï¼š
```
âœ… è¿™ä¸ªä»»åŠ¡å±äºæˆ‘ï¼ˆAgent XXXï¼‰çš„èŒè´£èŒƒå›´ã€‚
æ¶‰åŠæ¨¡å—ï¼šxxx
å½“å‰æ­¥éª¤ï¼šxxx
å¼€å§‹å¤„ç†...
```

### 4. å¦‚æœä»»åŠ¡ä¸å±äºä½ çš„èŒè´£
å›å¤æ ¼å¼ï¼š
```
âš ï¸ è¿™ä¸ªä»»åŠ¡ä¸å±äºæˆ‘ï¼ˆAgent XXXï¼‰çš„èŒè´£èŒƒå›´ã€‚

è¯¥ä»»åŠ¡æ¶‰åŠ [æ­¥éª¤å]ï¼Œåº”è¯¥ç”±ä»¥ä¸‹ Agent å¤„ç†ï¼š
â†’ Agent YYYï¼ˆè´Ÿè´£ xxxï¼‰

è¯·åœ¨å¦ä¸€ä¸ª Cursor Chat ä¼šè¯ä¸­è”ç³»è¯¥ Agentã€‚
```

### 5. å¦‚æœä»»åŠ¡è·¨è¶Šå¤šä¸ª Agent
å›å¤æ ¼å¼ï¼š
```
ğŸ“‹ è¿™ä¸ªä»»åŠ¡æ¶‰åŠå¤šä¸ª Agent çš„èŒè´£ï¼š
- [éƒ¨åˆ†1] â†’ Agent XXX
- [éƒ¨åˆ†2] â†’ Agent YYY

å»ºè®®ï¼š
1. æˆ‘å¯ä»¥å¤„ç† [éƒ¨åˆ†1]
2. è¯·è”ç³» Agent YYY å¤„ç† [éƒ¨åˆ†2]

æ˜¯å¦è¦æˆ‘å…ˆå¤„ç†æˆ‘è´Ÿè´£çš„éƒ¨åˆ†ï¼Ÿ
```

---

## ğŸ“ æ–‡ä»¶å½’å±çŸ©é˜µ

### ğŸ”´ EXCLUSIVE (ç‹¬å ) - åªæœ‰æŒ‡å®š Agent å¯ä¿®æ”¹

| ç›®å½•/æ–‡ä»¶ | Owner |
|----------|-------|
| `docs/specs/` | Agent PO |
| `docs/stories/` | Agent PO |
| `contracts/` | Agent ARCH |
| `src/shared/` | Agent ARCH |
| `docs/architecture/` | Agent ARCH |
| `src/trading/` | Agent TRADING |
| `src/portfolio/` | Agent PORTFOLIO |
| `src/web/` | Agent WEB |
| `src/ai/` | Agent AI |
| `tests/` | Agent QA |
| `docs/user_guide/` | Agent QA |
| `logs/reviews/` | Agent REVIEW |
| `status/` | Agent PM |
| `logs/audit_trail.json` | Agent PM |
| `docs/agents/` | Agent PM |
| `project_manifest.json` | Agent PM |

### ğŸŸ¡ COORDINATED (éœ€åè°ƒ) - ä¿®æ”¹éœ€å‘èµ·è¯·æ±‚

| æ–‡ä»¶ | åè°ƒè§„åˆ™ |
|------|---------|
| `requirements.txt` | åœ¨ `status/agent_requests.json` å‘èµ· CONFIG è¯·æ±‚ |
| `pyproject.toml` | åœ¨ `status/agent_requests.json` å‘èµ· CONFIG è¯·æ±‚ |
| `.cursorrules` | ä»… Agent PM å¯ä¿®æ”¹ï¼ˆé¡¹ç›®æ²»ç†è§„åˆ™æ–‡ä»¶ï¼‰ |

### ğŸŸ¢ SHARED-APPEND (å…±äº«è¿½åŠ )

| æ–‡ä»¶ | è¿½åŠ è§„åˆ™ |
|------|---------|
| `status/roadmap.json` | åªèƒ½ä¿®æ”¹è‡ªå·±è´Ÿè´£æ­¥éª¤çš„ `status.*` å­—æ®µ |
| `status/agent_requests.json` | åªèƒ½è¿½åŠ æ–°è¯·æ±‚æˆ–æ›´æ–°è‡ªå·±è¯·æ±‚çš„çŠ¶æ€ |
| `logs/audit_trail.json` | åªèƒ½è¿½åŠ ï¼Œä¸å¯ä¿®æ”¹å†å² |

---

## ğŸ”’ JSON ä¿®æ”¹è§„åˆ™

### `status/roadmap.json`

**å…è®¸ä¿®æ”¹çš„å­—æ®µ**ï¼š
- `status.*` (ä»…è‡ªå·±è´Ÿè´£çš„æ­¥éª¤)
- `current_step`
- `blockers`

**ç¦æ­¢ä¿®æ”¹çš„å­—æ®µ**ï¼š
- `id`, `category`, `description`, `owner`
- `artifacts.*`, `priority`, `depends_on`, `blocks`
- ä»»ä½•æ–°å¢çš„ Key

---

## ğŸ“‹ äº§å‡ºç‰©æ¨¡ç‰ˆ / Artifact Templates

### A. Roadmap (status/roadmap.json) / è·¯çº¿å›¾

**Purpose / ç›®çš„**: ç®¡ç† Feature å’Œ Story çš„ä»å±å…³ç³»ï¼Œæä¾›å±‚çº§ç»“æ„è§†å›¾  
**Purpose**: Manage Feature and Story hierarchy, provide hierarchical structure view

**Template / æ¨¡æ¿**:

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "2.0.0",
  "project": "MarketMakerDemo",
  "last_synced": "2025-12-01",
  "epics": [
    {
      "id": "EPIC-01",
      "name": "Payment System / æ”¯ä»˜ç³»ç»Ÿ",
      "name_zh": "æ”¯ä»˜ç³»ç»Ÿ",
      "status": "IN_PROGRESS",
      "module_id": "trading",
      "stories": [
        {
          "id": "US-101",
          "name": "WeChat Pay Integration / å¾®ä¿¡æ”¯ä»˜é›†æˆ",
          "name_zh": "å¾®ä¿¡æ”¯ä»˜é›†æˆ",
          "status": "DONE",
          "current_step": "release_approved",
          "branch": "feat/US-101-wechat-pay",
          "sync_source": "docs/modules/trading.json"
        },
        {
          "id": "US-102",
          "name": "AliPay Integration / æ”¯ä»˜å®é›†æˆ",
          "name_zh": "æ”¯ä»˜å®é›†æˆ",
          "status": "TODO",
          "current_step": "spec_defined",
          "branch": "pending",
          "sync_source": "docs/modules/trading.json"
        },
        {
          "id": "US-103",
          "name": "Refund API / é€€æ¬¾ API",
          "name_zh": "é€€æ¬¾ API",
          "status": "IN_PROGRESS",
          "current_step": "code_implemented",
          "branch": "feat/US-103-refund-api",
          "sync_source": "docs/modules/trading.json"
        }
      ]
    }
  ],
  "features": [
    {
      "id": "CORE-001",
      "module_id": "trading",
      "current_step": "spec_defined",
      "sync_source": "docs/modules/trading.json"
    }
  ],
  "notes": "Epics contain multiple stories. Features without epics are standalone. Feature states are defined inside module cards; roadmap keeps lightweight pointers only."
}
```

**å­—æ®µè¯´æ˜ / Field Descriptions**:

- **epics** (å¯é€‰ / Optional): Epic å®¹å™¨ï¼ŒåŒ…å«å¤šä¸ª User Stories
  - `id`: Epic ID (æ ¼å¼: EPIC-{NUMBER})
  - `name`: Epic åç§°ï¼ˆä¸­è‹±æ–‡ï¼‰
  - `status`: Epic çŠ¶æ€ (TODO, IN_PROGRESS, DONE, BLOCKED)
  - `module_id`: æ‰€å±æ¨¡å—
  - `stories`: Story æ•°ç»„ï¼Œæ¯ä¸ª Story åŒ…å«ï¼š
    - `id`: User Story ID (æ ¼å¼: US-{ID})
    - `name`: Story åç§°ï¼ˆä¸­è‹±æ–‡ï¼‰
    - `status`: Story çŠ¶æ€ (TODO, IN_PROGRESS, DONE, BLOCKED)
    - `current_step`: å½“å‰å¼€å‘æ­¥éª¤ï¼ˆ17 æ­¥æµç¨‹ä¸­çš„æ­¥éª¤ï¼‰
    - `branch`: Git åˆ†æ”¯åï¼ˆ`pending` è¡¨ç¤ºæœªåˆ›å»ºï¼‰
    - `sync_source`: åŒæ­¥æºï¼ˆæŒ‡å‘ module cardï¼‰

- **features** (å¯é€‰ / Optional): ç‹¬ç«‹çš„ Featureï¼ˆä¸å±äºä»»ä½• Epicï¼‰
  - ä¿æŒåŸæœ‰è½»é‡çº§æŒ‡é’ˆç»“æ„
  - ç”¨äºä¸éœ€è¦æ‹†åˆ†ä¸ºå¤šä¸ª Story çš„ç®€å• Feature

**Status Values / çŠ¶æ€å€¼**:
- `TODO`: æœªå¼€å§‹ / Not started
- `IN_PROGRESS`: è¿›è¡Œä¸­ / In progress
- `DONE`: å·²å®Œæˆ / Completed
- `BLOCKED`: è¢«é˜»å¡ / Blocked

**Notes / è¯´æ˜**:
- Epic å’Œ Feature å¯ä»¥å…±å­˜ï¼ˆEpic ç”¨äºå¤æ‚åŠŸèƒ½ï¼ŒFeature ç”¨äºç®€å•åŠŸèƒ½ï¼‰
- æ¯ä¸ª Story å¿…é¡»å…³è”åˆ°å¯¹åº”çš„ Featureï¼ˆé€šè¿‡ `sync_source`ï¼‰
- Story çš„è¯¦ç»†çŠ¶æ€ä»ç„¶å­˜å‚¨åœ¨ `docs/modules/{module}.json` ä¸­
- Roadmap ä¿æŒè½»é‡çº§ï¼Œåªå­˜å‚¨æŒ‡é’ˆå’Œå±‚çº§å…³ç³»

---

### B. User Story (docs/stories/{module}/US-{ID}.md) / ç”¨æˆ·æ•…äº‹

**Purpose / ç›®çš„**: å®šä¹‰ç”¨æˆ·éœ€æ±‚ã€éªŒæ”¶æ ‡å‡†å’ŒæŠ€æœ¯å¤‡æ³¨  
**Purpose**: Define user requirements, acceptance criteria, and technical notes

**Template / æ¨¡æ¿**:

```markdown
# {STORY_ID}: {Title} / {ä¸­æ–‡æ ‡é¢˜}

## Metadata / å…ƒæ•°æ®

- **id**: "US-101"
- **parent_feature**: "EPIC-01: Payment System" æˆ– "CORE-001: Exchange Connection"
- **parent_feature_zh**: "EPIC-01: æ”¯ä»˜ç³»ç»Ÿ" æˆ– "CORE-001: äº¤æ˜“æ‰€è¿æ¥"
- **module**: "trading"
- **owner_agent**: "Agent TRADING"

## User Story / ç”¨æˆ·æ•…äº‹

**As a** {role}  
**I want** {feature}  
**So that** {benefit}

**ä½œä¸º** {è§’è‰²}  
**æˆ‘å¸Œæœ›** {åŠŸèƒ½}  
**ä»¥ä¾¿** {æ”¶ç›Š}

## Acceptance Criteria / éªŒæ”¶æ ‡å‡†

### AC-1: {Criterion Title} / {æ ‡å‡†æ ‡é¢˜}
**Given** {precondition}  
**When** {action}  
**Then** {expected result}

**Given** {å‰ç½®æ¡ä»¶}  
**When** {æ“ä½œ}  
**Then** {é¢„æœŸç»“æœ}

### AC-2: ...

## Technical Notes / æŠ€æœ¯å¤‡æ³¨
...

## Related / ç›¸å…³
- Spec: `docs/specs/{module}/{feature}.md`
- Feature: `{FEATURE_ID}` (e.g., CORE-001)
- Epic: `{EPIC_ID}` (e.g., EPIC-01) - å¦‚æœå±äº Epic
- Tests: `tests/unit/{module}/test_{feature}.py`
- Contract: `contracts/{module}.json`

## Owner / è´Ÿè´£äºº
Agent: {AGENT_NAME}
```

**å­—æ®µè¯´æ˜ / Field Descriptions**:

- **id**: User Story ID (æ ¼å¼: US-{ID}, å¦‚ US-101, US-CORE-004)
- **parent_feature**: çˆ¶çº§ Feature æˆ– Epic çš„å¼•ç”¨
  - æ ¼å¼: `"{EPIC_ID}: {Epic Name}"` æˆ– `"{FEATURE_ID}: {Feature Name}"`
  - ç¤ºä¾‹: `"EPIC-01: Payment System"` æˆ– `"CORE-001: Exchange Connection"`
  - å¦‚æœ Story å±äº Epicï¼Œä½¿ç”¨ Epic ID
  - å¦‚æœ Story ç›´æ¥å±äº Featureï¼Œä½¿ç”¨ Feature ID
- **parent_feature_zh**: çˆ¶çº§ Feature æˆ– Epic çš„ä¸­æ–‡åç§°
- **module**: æ‰€å±æ¨¡å— (trading, portfolio, web, ai, qa)
- **owner_agent**: è´Ÿè´£çš„å¼€å‘ Agent

**Notes / è¯´æ˜**:
- `parent_feature` å­—æ®µç”¨äºå»ºç«‹ Story ä¸ Feature/Epic çš„å±‚çº§å…³ç³»
- å¦‚æœ Story å±äº Epicï¼Œ`parent_feature` åº”æŒ‡å‘ Epic
- å¦‚æœ Story ç›´æ¥å±äº Featureï¼ˆæ—  Epicï¼‰ï¼Œ`parent_feature` åº”æŒ‡å‘ Feature
- æ­¤å­—æ®µå¸®åŠ© Agent PM ç®¡ç†ä»å±å…³ç³»å’Œè¿›åº¦è·Ÿè¸ª

---

## ğŸš« ä¸¥æ ¼é¡ºåºè§„åˆ™ (TDD)

### ç¦æ­¢è·³æ­¥
- âŒ å½“ `spec_defined: false` æ—¶ï¼Œä¸è¦å†™ Story
- âŒ å½“ `story_defined: false` æ—¶ï¼Œä¸è¦å†™ AC
- âŒ å½“ `ac_defined: false` æ—¶ï¼Œä¸è¦è¿›è¡Œ Plan Approval
- âŒ å½“ `plan_approved: false` æ—¶ï¼Œä¸è¦å®šä¹‰ Contract (**NEW**)
- âŒ å½“ `contract_defined: false` æ—¶ï¼Œä¸è¦å†™ Test
- âŒ å½“ `unit_test_written: false` æ—¶ï¼Œä¸è¦å†™ Code (**TDD åŸåˆ™**)
- âŒ å½“ `code_implemented: false` æ—¶ï¼Œä¸è¦è¿›è¡Œ Lint æ£€æŸ¥
- âŒ å½“ `lint_passed: false` æ—¶ï¼Œä¸è¦è¿›è¡Œ Security æ£€æŸ¥ (**NEW**)
- âŒ å½“ `security_check_passed: false` æ—¶ï¼Œä¸è¦ Review (**NEW**)
- âŒ å½“ `code_reviewed: false` æ—¶ï¼Œä¸è¦è¿è¡Œæµ‹è¯•
- âŒ å½“ `ci_cd_passed: false` æ—¶ï¼Œä¸è¦æ‰¹å‡†å‘å¸ƒ (**NEW**)

### TDD åŸåˆ™
**Step 6 (unit_test_written) å¿…é¡»åœ¨ Step 7 (code_implemented) ä¹‹å‰å®Œæˆ**
```
1. Dev Agent å…ˆå†™æµ‹è¯• (æµ‹è¯•ä¼šå¤±è´¥ï¼Œå› ä¸ºä»£ç è¿˜æ²¡å†™) - **Red Phase**
2. Dev Agent å®ç°ä»£ç ï¼Œç›®æ ‡æ˜¯è®©æµ‹è¯•é€šè¿‡ - **Green Phase**
```

---

## ğŸ“– ä¸Šä¸‹æ–‡æ§åˆ¶è§„åˆ™

### ç¦æ­¢
- âŒ ä½¿ç”¨ @Codebase å…¨é‡ç´¢å¼•
- âŒ è¯»å–ä¸å±äºè‡ªå·±èŒè´£çš„ä»£ç å®ç°

### å…è®¸
- âœ… è¯»å–è‡ªå·±çš„ä¸Šä¸‹æ–‡æ–‡æ¡£ `docs/agents/AGENT_XXX.md`
- âœ… è¯»å– `status/roadmap.json`
- âœ… è¯»å– `contracts/*.json` (æ¥å£å¥‘çº¦ï¼Œæ‰€æœ‰ Agent å¯è¯»)
- âœ… è¯»å–è‡ªå·±è´Ÿè´£ç›®å½•ä¸‹çš„æ–‡ä»¶

---

## ğŸ›¡ï¸ æ ¸å¿ƒåŸåˆ™

1. **ä¸è¶Šç•Œä¿®æ”¹**ï¼šæ¯ä¸ª Agent åªè´Ÿè´£æŒ‡å®šçš„æ¨¡å—
2. **å…ˆé˜…è¯»åä¿®æ”¹**ï¼šå¿…é¡»å…ˆç†è§£ç›¸å…³æ–‡ä»¶ï¼Œä¸è¦çŒœæµ‹
3. **å…±äº«æ–‡ä»¶åè°ƒ**ï¼šä¿®æ”¹å…±äº«é…ç½®éœ€å‘èµ·è¯·æ±‚
4. **éµå¾ªç°æœ‰é£æ ¼**ï¼šä¿æŒä»£ç é£æ ¼å’Œæ¶æ„ä¸€è‡´

---

## ğŸš« ç¦æ­¢æ“ä½œ

- ä¸è¦ä¿®æ”¹ `.git` ç›®å½•
- ä¸è¦åˆ é™¤ç°æœ‰æµ‹è¯•
- ä¸è¦å¼•å…¥ç ´åæ€§å˜æ›´
- ä¸è¦è·³è¿‡å¼€å‘æµç¨‹æ­¥éª¤

---

## ğŸ“ ä»£ç è§„èŒƒ

- Python: PEP 8 é£æ ¼
- ç±»å‹æ³¨è§£: æ¨èä½¿ç”¨
- æ–‡æ¡£å­—ç¬¦ä¸²: Google é£æ ¼
- æµ‹è¯•è¦†ç›–: æ–°åŠŸèƒ½å¿…é¡»æœ‰æµ‹è¯•

---

## ğŸ“ Git æäº¤è§„èŒƒ

```
<type>(<scope>): <description>

Types: feat, fix, docs, refactor, test, chore, spec, story, contract, review
Scopes: trading, portfolio, web, ai, shared, progress
```

ç¤ºä¾‹ï¼š
```
spec(trading): CORE-001 add exchange connection specification
story(trading): CORE-001 add user story with acceptance criteria
contract(trading): CORE-001 define ExchangeClient interface
test(trading): CORE-001 add unit tests for exchange client
feat(trading): CORE-001 implement exchange connection
review(trading): CORE-001 code review approved
docs(trading): CORE-001 update user guide
```

---

## ğŸ› ï¸ Git è‡ªåŠ¨åŒ–ç­–ç•¥ / Git Automation Rules

**Rule / è§„åˆ™**: ä¸¥ç¦ç›´æ¥åœ¨ `main` åˆ†æ”¯ä¿®æ”¹ä»£ç ã€‚æ‰€æœ‰å·¥ä½œå¿…é¡»åœ¨ Feature åˆ†æ”¯å®Œæˆã€‚
**Rule**: Never modify code directly on `main` branch. All work must be done on Feature branches.

### åˆ†æ”¯å‘½åè§„èŒƒ / Branch Naming Convention

- **Format / æ ¼å¼**: `feat/{US-ID}-{short_slug}`
- **Example / ç¤ºä¾‹**: `feat/US-101-user-login`

### åˆ†æ”¯åˆ›å»ºè§„åˆ™ / Branch Creation Rules

- **Source / æºåˆ†æ”¯**: Always create new branches from updated `main`.
- **æºåˆ†æ”¯**: å§‹ç»ˆä»æœ€æ–°çš„ `main` åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯ã€‚

### åˆ†æ”¯ç²’åº¦è§„åˆ™ / Branch Granularity Rules

- **Granularity / ç²’åº¦**: One Branch = One User Story.
- **ç²’åº¦**: ä¸€ä¸ªåˆ†æ”¯ = ä¸€ä¸ªç”¨æˆ·æ•…äº‹ã€‚
- **Epic Handling / Epic å¤„ç†**: If a request involves multiple stories, break them down first. Never create a branch for an entire Epic.
- **Epic å¤„ç†**: å¦‚æœè¯·æ±‚æ¶‰åŠå¤šä¸ªæ•…äº‹ï¼Œå…ˆæ‹†åˆ†ã€‚æ°¸è¿œä¸è¦ä¸ºæ•´ä¸ª Epic åˆ›å»ºåˆ†æ”¯ã€‚

### æäº¤æ¶ˆæ¯è§„èŒƒ / Commit Message Convention

- **Format / æ ¼å¼**: `type(scope): subject (ref #{US-ID})`
- **Example / ç¤ºä¾‹**: `feat(auth): add password validation (ref #US-101)`

### Agent æ“ä½œæŒ‡å— / Agent Operation Guide

1. **Before Start / å¼€å§‹å‰**:
   - è¿è¡Œ `git checkout main && git pull` ç¡®ä¿åŸºå‡†æœ€æ–°
   - Run `git checkout main && git pull` to ensure baseline is up-to-date

2. **Create Branch / åˆ›å»ºåˆ†æ”¯**:
   - è¿è¡Œ `git checkout -b feat/{US-ID}-{slug}`
   - Run `git checkout -b feat/{US-ID}-{slug}`

3. **On Finish / å®Œæˆå**:
   - ç­‰å¾… CI é€šè¿‡åï¼Œæç¤ºç”¨æˆ·è¿›è¡Œ Squash Merge
   - After CI passes, prompt user to perform Squash Merge

---

## ğŸ”„ è·¨ Agent è¯·æ±‚åè®®

å½“éœ€è¦å…¶ä»– Agent é…åˆæ—¶ï¼Œåœ¨ `status/agent_requests.json` ä¸­æ·»åŠ è¯·æ±‚ï¼š

```json
{
  "id": "REQ-001",
  "from": "Agent TRADING",
  "to": "Agent ARCH",
  "type": "INTERFACE",
  "priority": "HIGH",
  "feature": "CORE-001",
  "description": "éœ€è¦åœ¨ contracts/trading.json ä¸­æ·»åŠ  cancelOrder æ¥å£",
  "status": "OPEN",
  "created": "2025-11-30T10:00:00Z"
}
```

è¯·æ±‚ç±»å‹ï¼š
- `INTERFACE` - éœ€è¦æ·»åŠ /ä¿®æ”¹æ¥å£
- `CONFIG` - éœ€è¦ä¿®æ”¹å…±äº«é…ç½®
- `BLOCKER` - è¢«é˜»å¡ï¼Œéœ€è¦ä¼˜å…ˆå¤„ç†
- `REVIEW` - éœ€è¦ä»£ç å®¡æŸ¥
- `CLARIFY` - éœ€è¦æ¾„æ¸…éœ€æ±‚

---

## ğŸ¤– äº¤äº’æŒ‡ä»¤ / Interaction Guide

### ğŸŸ¢ å¯åŠ¨ä»»åŠ¡ / Start Task

#### åœºæ™¯ A: ç”¨æˆ·æƒ³è¦å¼€å‘ä¸€ä¸ªå¤§åŠŸèƒ½ (Epic/Feature)
**Scenario A: User wants to develop a large feature (Epic/Feature)**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"Start Feature: æ”¯ä»˜ç³»ç»Ÿ"` æˆ– `"Start Feature: Payment System"`

**æµç¨‹ / Workflow:**
1. **[Agent PO]** è¯†åˆ«è¿™æ˜¯ä¸€ä¸ª Epic / Identify this as an Epic
2. **[Agent PO]** å°†å…¶æ‹†è§£ä¸ºå¤šä¸ª User Stories (US-X, US-Y...) / Break it down into multiple User Stories
3. **[Agent PM]** æ›´æ–° `status/roadmap.json`ï¼Œåˆ›å»º Epic å®¹å™¨ / Update `status/roadmap.json`, create Epic container
4. **[Human]** ç”¨æˆ·ç¡®è®¤æ‹†è§£æ–¹æ¡ˆ / User confirms breakdown plan
5. **[Agent PO]** è¯¢é—®: "Shall we start with the first story US-X?" / Ask: "Shall we start with the first story US-X?"

#### åœºæ™¯ B: ç”¨æˆ·æƒ³è¦å¼€å‘å…·ä½“ Story
**Scenario B: User wants to develop a specific Story**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"Start Story US-101"` æˆ– `"Start first story"` æˆ– `"å¼€å§‹ US-CORE-004"`

**æµç¨‹ / Workflow:**
1. **[Dev Agent]** æ£€æŸ¥ `main` åˆ†æ”¯æ›´æ–° / Check `main` branch updates
   ```bash
   git checkout main && git pull
   ```

2. **[Dev Agent]** åˆ›å»ºåˆ†æ”¯: `git checkout -b feat/US-101-{slug}`
   - **Critical Rule / å…³é”®è§„åˆ™**: å³ä½¿å±äºåŒä¸€ä¸ª Epicï¼Œä¸åŒ Story ä¹Ÿå¿…é¡»ä½¿ç”¨ç‹¬ç«‹çš„ Git åˆ†æ”¯
   - **Critical Rule**: Even if stories belong to the same Epic, different Stories must use separate Git branches

3. **[Dev Agent]** æ£€æŸ¥å½“å‰æ­¥éª¤ / Check current step
   - è¯»å– `status/roadmap.json` æˆ– `docs/modules/{module}.json` ä¸­çš„ `current_step`
   - Read `current_step` from `status/roadmap.json` or `docs/modules/{module}.json`

4. **[Dev Agent]** å¼€å§‹å¯¹åº”æ­¥éª¤ / Start corresponding step
   - å¦‚æœ `current_step: spec_defined` â†’ ç­‰å¾… Agent PO å®Œæˆ Story
   - If `current_step: spec_defined` â†’ Wait for Agent PO to complete Story
   - å¦‚æœ `current_step: story_defined` â†’ ç­‰å¾… Agent PO å®Œæˆ AC
   - If `current_step: story_defined` â†’ Wait for Agent PO to complete AC
   - å¦‚æœ `current_step: plan_approved` â†’ å¼€å§‹ Step 5 (Contract)
   - If `current_step: plan_approved` â†’ Start Step 5 (Contract)

#### åœºæ™¯ C: ç”¨æˆ·æƒ³è¦ç»§ç»­å½“å‰ Story
**Scenario C: User wants to continue current Story**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"Continue"` æˆ– `"ç»§ç»­"` æˆ– `"Next step"`

**æµç¨‹ / Workflow:**
1. **[Current Agent]** æ£€æŸ¥å½“å‰æ­¥éª¤ / Check current step
2. **[Current Agent]** ç¡®è®¤ä¸‹ä¸€æ­¥ / Confirm next step
3. **[Current Agent]** æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ / Execute next step operation
4. **[Current Agent]** ä½¿ç”¨ `scripts/advance_feature.py` æ›´æ–°çŠ¶æ€ / Use `scripts/advance_feature.py` to update status

#### åœºæ™¯ D: ç”¨æˆ·æƒ³è¦æŸ¥è¯¢çŠ¶æ€
**Scenario D: User wants to query status**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"Status of CORE-004"` æˆ– `"CORE-004 çŠ¶æ€"` æˆ– `"Show roadmap"`

**æµç¨‹ / Workflow:**
1. **[Agent PM]** è¯»å– `status/roadmap.json` / Read `status/roadmap.json`
2. **[Agent PM]** è¯»å– `docs/modules/{module}.json` è·å–è¯¦ç»†ä¿¡æ¯ / Read `docs/modules/{module}.json` for detailed info
3. **[Agent PM]** æ˜¾ç¤ºå½“å‰æ­¥éª¤ã€é˜»å¡ã€ä¾èµ–å…³ç³» / Display current step, blockers, dependencies

### ğŸŸ¡ ä»»åŠ¡æ‰§è¡Œ / Task Execution

#### åœºæ™¯ E: éœ€è¦è·¨ Agent åä½œ
**Scenario E: Cross-Agent collaboration needed**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"I need Agent ARCH to define interface"` æˆ– `"éœ€è¦æ¶æ„å¸ˆå®šä¹‰æ¥å£"`

**æµç¨‹ / Workflow:**
1. **[Current Agent]** è¯†åˆ«éœ€è¦åä½œçš„ Agent / Identify Agent needed for collaboration
2. **[Current Agent]** åœ¨ `status/agent_requests.json` åˆ›å»ºè¯·æ±‚ / Create request in `status/agent_requests.json`
3. **[Current Agent]** æç¤ºç”¨æˆ·è”ç³»ç›®æ ‡ Agent / Prompt user to contact target Agent
4. **[Target Agent]** å¤„ç†è¯·æ±‚å¹¶æ›´æ–°çŠ¶æ€ / Process request and update status

#### åœºæ™¯ F: é‡åˆ°é˜»å¡
**Scenario F: Encounter blocker**

*ç”¨æˆ·è¾“å…¥ / User Input*: `"Blocked by CORE-001"` æˆ– `"è¢« CORE-001 é˜»å¡"`

**æµç¨‹ / Workflow:**
1. **[Current Agent]** æ›´æ–° `status/roadmap.json` ä¸­çš„ `blockers` å­—æ®µ / Update `blockers` field in `status/roadmap.json`
2. **[Agent PM]** ç›‘æ§é˜»å¡çŠ¶æ€ / Monitor blocker status
3. **[Agent PM]** åè°ƒè§£å†³é˜»å¡ / Coordinate blocker resolution

### ğŸ”´ åœæ­¢é—¨ç¦ / Stop Gates

#### åœºæ™¯ G: åˆ°è¾¾ Plan Approval (Step 4)
**Scenario G: Reach Plan Approval (Step 4)**

**æµç¨‹ / Workflow:**
1. **[Agent PO]** å®Œæˆ Steps 1-3 (Spec, Story, AC) / Complete Steps 1-3
2. **[Agent PO]** æç¤º: "ğŸ›‘ STOP GATE: ç­‰å¾…è®¡åˆ’æ‰¹å‡†" / Prompt: "ğŸ›‘ STOP GATE: Waiting for plan approval"
3. **[Human]** å®¡æŸ¥å¹¶æ‰¹å‡† / Review and approve
4. **[Agent PO]** æ›´æ–° `current_step: plan_approved` / Update `current_step: plan_approved`
5. **[Agent PO]** ç»§ç»­ Step 5 (Contract) / Continue to Step 5 (Contract)

#### åœºæ™¯ H: åˆ°è¾¾ Release Approval (Step 17)
**Scenario H: Reach Release Approval (Step 17)**

**æµç¨‹ / Workflow:**
1. **[Agent PM]** å®Œæˆ Steps 14-16 (Docs, Progress, CI/CD) / Complete Steps 14-16
2. **[Agent PM]** æç¤º: "ğŸ›‘ STOP GATE: ç­‰å¾…å‘å¸ƒæ‰¹å‡†" / Prompt: "ğŸ›‘ STOP GATE: Waiting for release approval"
3. **[Human]** å®¡æŸ¥å¹¶æ‰¹å‡†å‘å¸ƒ / Review and approve release
4. **[Agent PM]** æ›´æ–° `current_step: release_approved` / Update `current_step: release_approved`

### ğŸ“‹ å¸¸ç”¨æŒ‡ä»¤ / Common Commands

| ç”¨æˆ·è¾“å…¥ / User Input | å“åº” Agent | æ“ä½œ / Action |
|----------------------|-----------|--------------|
| `"Start Feature: {name}"` | Agent PO | åˆ›å»º Epic å¹¶æ‹†è§£ä¸º Stories |
| `"Start Story {US-ID}"` | Dev Agent | åˆ›å»ºåˆ†æ”¯å¹¶å¼€å§‹å¼€å‘ |
| `"Continue"` | Current Agent | ç»§ç»­å½“å‰æ­¥éª¤ |
| `"Status of {feature-id}"` | Agent PM | æ˜¾ç¤ºåŠŸèƒ½çŠ¶æ€ |
| `"Blocked by {feature-id}"` | Current Agent | æ ‡è®°é˜»å¡ |
| `"Need {Agent Name}"` | Current Agent | åˆ›å»ºè·¨ Agent è¯·æ±‚ |

---

## ğŸ’¡ Agent å¿«é€Ÿå‚è€ƒ

| Agent | è´Ÿè´£æ­¥éª¤ | è´Ÿè´£ç›®å½• | Notes / å¤‡æ³¨ |
|-------|---------|---------|-------------|
| Agent PM | 15 | `status/`, `logs/`, `docs/agents/`, `.cursorrules` | è¿›åº¦è·Ÿè¸ªã€åè°ƒæ²Ÿé€šã€é£é™©ç®¡ç†ã€é¡¹ç›®æ²»ç† |
| Agent PO | 1, 2, 3 | `docs/specs/`, `docs/stories/` | |
| Human | 4, 17 | â€” | ğŸ›‘ STOP GATES |
| Agent ARCH | 5 | `contracts/`, `src/shared/` | |
| Agent TRADING | 6, 7, 8, 9, 11 | `src/trading/` | Steps 8-9 with tools |
| Agent PORTFOLIO | 6, 7, 8, 9, 11 | `src/portfolio/` | Steps 8-9 with tools |
| Agent WEB | 6, 7, 8, 9, 11 | `src/web/` | Steps 8-9 with tools |
| Agent AI | 6, 7, 8, 9, 11 | `src/ai/` | Steps 8-9 with tools |
| Agent QA | 12, 13, 14 | `tests/`, `docs/user_guide/` | |
| Agent REVIEW | 10 | `logs/reviews/` | |
| Automated | 16 | â€” | CI/CD pipeline |
